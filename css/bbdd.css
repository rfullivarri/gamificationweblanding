/**************************************
 * BBDD Editor — CSS limpio (canónico)
 * (sin THEAD visual, sin duplicados)
 **************************************/

/* --- Tokens --- */
:root{
  --brand:#7d3cff;
  --ink:#ecedff;
  --ink-soft:#cfd3ff;
  --bg:#0b1020;
  --panel-0:#0e1224;
  --panel-1:#121736;

  --glass-1: rgba(18,22,45,.75);
  --glass-2: rgba(12,16,35,.75);

  --line: rgba(122,134,255,.18);
  --line-soft: rgba(122,134,255,.14);

  --chip:#1b2247;
  --ok:#1ec28b;
  --danger:#ff5364;

  --input-bg: rgba(12,16,36,.6);
  --input-brd: rgba(122,134,255,.22);

  /* Anchos de columnas (desktop) */
  --col-gap: 5px;
  --w-pilar:        10%;
  --w-rasgo:        12%;
  --w-stat:         12%;
  --w-task:         38%;
  --w-dificultad:   11%;
  --w-feedback:      9%;
  --w-eliminar:      8%;
}

/* --- Base --- */
*{ box-sizing:border-box; }
html,body{
  margin:0; padding:0;
  background:#0c1020;
  color:var(--ink);
  font-family:"Inter",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
}

/* --- Overlay/Panel (glass) --- */
.bbdd-overlay{
  position:fixed; inset:0; z-index:9999;
  display:flex; align-items:center; justify-content:center;
  padding:24px;
  background: radial-gradient(1200px 800px at 20% -10%, rgba(124,77,255,.10), transparent 60%),
              linear-gradient(180deg, rgba(6,8,16,.60), rgba(6,8,16,.70));
  backdrop-filter: blur(16px) saturate(1.08);
  -webkit-backdrop-filter: blur(16px) saturate(1.08);
}
.bbdd-overlay.hidden{ display:none !important; }

.bbdd-panel{
  width:min(1200px,100%);
  height:min(96vh,100vh);
  display:flex; flex-direction:column;
  border:1px solid var(--line);
  border-radius:14px;
  background: linear-gradient(180deg,var(--glass-1),var(--glass-2));
  box-shadow: 0 24px 80px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04);
}

/* --- Header / Tools --- */
.bbdd-header{
  position:sticky; top:0; z-index:40;
  display:flex; align-items:center; gap:10px;
  padding:12px 16px;
  background: linear-gradient(180deg, rgba(22,27,62,.85), rgba(16,21,48,.70));
  border-bottom:1px solid var(--line);
  color:var(--ink);
}
.bbdd-header h1{ margin:0; font-size:18px; font-weight:700; }
.spacer{ flex:1; }

.bbdd-tools{
  position:sticky; top:56px; z-index:35;
  display:grid;
  grid-template-columns: 1fr minmax(280px,520px) 1fr;
  align-items:center; gap:12px;
  padding:10px 16px;
  background: rgba(16, 20, 38, 0.45);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  border-bottom: 1px solid var(--line-soft);
}
.bbdd-tools .left{ justify-self:start; display:flex; gap:10px; align-items:center; }
.bbdd-tools .center{ justify-self:center; width:100%; }
.bbdd-tools .right{ justify-self:end; }

/* --- Info card --- */
.gj-info{
  margin:12px 16px; padding:12px 14px;
  background: linear-gradient(180deg, rgba(19,24,54,.65), rgba(16,22,46,.55));
  border:1px solid var(--line);
  border-left:4px solid var(--brand);
  border-radius:12px;
  color:var(--ink);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
}
.gj-info .legend{ margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:#bfc6ff; }
.gj-info .legend span{
  background:#141a39; border:1px solid #2a3466;
  padding:6px 8px; border-radius:8px;
}

/* --- Inputs/Buttons --- */
.input, select, textarea{
  width:100%; outline:none;
  background: var(--input-bg);
  border:1px solid var(--input-brd);
  color:var(--ink);
  border-radius:12px; padding:9px 10px;
  transition: border-color .15s ease, box-shadow .15s ease;
}
.input::placeholder{ color:#b7c0ff; opacity:.9; }
.input:focus, select:focus, textarea:focus{
  border-color:#7d3cff; box-shadow:0 0 0 3px rgba(125,60,255,.18);
}

.btn{
  background:#7d3cff; color:#fff;
  border:1px solid rgba(125,60,255,.6);
  padding:9px 14px; border-radius:12px;
  font-weight:700; cursor:pointer;
}
.btn:hover{ filter:brightness(1.06); }
.btn.ghost{
  background: rgba(26,31,68,.6);
  border:1px solid rgba(122,134,255,.20);
  color:#cfd3ff;
}
.btn.success{ background:var(--ok); color:#072a18; border:1px solid #27dca0; }
.btn.danger{ background:var(--danger); border:1px solid #ff7682; }

.btn.loading{ opacity:.7; cursor:wait; position:relative; }
.btn.loading::after{
  content:""; position:absolute; right:12px; top:50%; transform:translateY(-50%);
  width:14px; height:14px; border:2px solid currentColor; border-top-color:transparent;
  border-radius:50%; animation: spin .8s linear infinite;
}
@keyframes spin{ to{ transform:translateY(-50%) rotate(360deg); } }

.dot{ margin-left:10px; color:#ffd56a; }
.hidden{ display:none !important; }

/* --- Column bar (títulos fijos) --- */
.bbdd-columns{
  position:sticky; top:100px; z-index:30;
  display:grid;
  grid-template-columns: var(--w-pilar) var(--w-rasgo) var(--w-stat) var(--w-task) var(--w-dificultad) var(--w-feedback) var(--w-eliminar);
  gap:var(--col-gap);
  margin:6px 4px 0;
  padding:8px 10px;
  border-radius:12px;
  background: linear-gradient(180deg, rgba(36, 38, 66, .86), rgba(24, 26, 44, .84));
  color:#dbe0ff; font-weight:600;
  border-bottom:1px solid var(--line);
}

/* --- Table wrapper (consolidado) --- */
#table-wrap{
  position: relative;
  margin: 13px 1px 1px 1px;
  border: 1px solid var(--line-soft);
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(16,22,48,.55), rgba(13,18,40,.55));
  overflow: auto;             /* scroll vive acá en desktop */
  min-height: 380px;          /* lienzo para spinner */
  max-height: 60vh;
}

/* --- Table (sin THEAD visual) --- */
#bbdd-table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  table-layout: fixed;         /* clave para truncado */
}
#bbdd-table col.col-pilar      { width: var(--w-pilar); }
#bbdd-table col.col-rasgo      { width: var(--w-rasgo); }
#bbdd-table col.col-stat       { width: var(--w-stat); }
#bbdd-table col.col-task       { width: var(--w-task); }
#bbdd-table col.col-dificultad { width: var(--w-dificultad); }
#bbdd-table col.col-feedback   { width: var(--w-feedback); }
#bbdd-table col.col-eliminar   { width: var(--w-eliminar); }

#bbdd-table thead,
#bbdd-table thead *{
  position:absolute !important;
  width:1px !important; height:1px !important;
  overflow:hidden !important;
  clip:rect(0 0 0 0) !important;
  clip-path: inset(50%) !important;
  white-space:nowrap !important;
  border:0 !important; padding:0 !important; margin:0 !important;
}

#bbdd-table tbody td{
  padding:8px 10px;
  border-bottom:1px solid rgba(120,130,190,.12);
  vertical-align:middle;
}
#bbdd-table tbody tr:hover td{
  background: linear-gradient(180deg, rgba(30, 32, 54, .78), rgba(22, 24, 44, .76));
  border-color: rgba(140,150,210,.22);
}

/* Truncado agradable para Tasks en desktop y mobile */
#bbdd-table tbody td:nth-child(4){
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* --- Feedback / acciones --- */
.feedback{ display:flex; gap:6px; align-items:center; justify-content:center; }
.feedback button{
  background: rgba(27,34,71,.6);
  border:1px solid rgba(122,134,255,.22);
  color:#cfd3ff; border-radius:10px; padding:6px 9px; font-size:12px; cursor:pointer;
}
.feedback button.active{ background: rgba(90,105,214,.32); border-color:#5a69d6; color:#ecedff; }
.row-actions{ display:flex; gap:6px; align-items:center; justify-content:flex-end; }
.row-actions .mini{
  background: rgba(26,31,68,.6);
  border:1px solid rgba(122,134,255,.20);
  color:#cfd3ff; border-radius:10px; padding:6px 8px; font-size:12px;
}

/* --- Spinner overlay (única versión) --- */
#table-spinner{
  position:absolute; inset:0;
  display:none; /* se muestra con .table-loading */
  z-index:6;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  background: rgba(10,12,24,.45);
  color: var(--ink);
  font-weight: 600;
  display:flex; align-items:center; justify-content:center; gap:12px;
}
#table-wrap.table-loading #table-spinner{ display:flex; }
#table-wrap.table-loading #bbdd-table{
  filter: blur(1px); opacity:.6; pointer-events:none;
}
#table-spinner .ring{
  width: 28px; height: 28px; border-radius: 50%;
  border: 3px solid rgba(255,255,255,.18);
  border-top-color: var(--brand);
  animation: gj-spin .9s linear infinite;
}
@keyframes gj-spin{ to{ transform: rotate(360deg); } }
#table-spinner .txt{ font-weight:600; opacity:.95; }

/* overlay IA (mismo layout que #table-spinner) */
#ai-spinner{
  position:absolute; inset:0; display:none; z-index:80;
  align-items:center; justify-content:center; gap:12px;
  backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
  background: rgba(10,12,24,.45); color:#ece6ff; font-weight:600;
}

/* encendido por clase del wrapper (igual lógica que table-loading) */
.bbdd-table-wrap.ai-loading #ai-spinner { display:flex; }

/* animación simple de chispas */
#ai-spinner .sparkles { 
  font-size:22px; 
  animation: twinkle 1.2s ease-in-out infinite;
}
/* Overlay AI dentro de la tabla */
#ai-sparkle {
  position: absolute;
  inset: 0;                  /* ocupa todo el contenedor padre */
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(3px);
  background: rgba(0,0,0,0.4); /* oscurece parejo */
  z-index: 20;
}

#table-wrap.ai-loading #ai-sparkle {
  display: flex; /* cuando activamos la clase .ai-loading */
}
@keyframes twinkle {
  0%,100% { transform: translateY(0) scale(1); opacity: .8; }
  50%     { transform: translateY(-4px) scale(1.15); opacity: 1; }
}

/* filas que la IA modificó (resaltado lila) */
tr.ai-updated td{
  outline: 2px solid #b084f5;
  box-shadow: 0 0 0 2px rgba(176,132,245,.15) inset;
  background: rgba(176,132,245,.06);
}
/* Highlight para tasks tocadas por la AI */
input.ai-updated {
  outline: 2px solid #a86bfa;   /* violeta lila */
  box-shadow: 0 0 8px #a86bfa;  /* glow suave */
  border-radius: 6px;           /* mismo redondeo que ya tiene */
  transition: outline 0.3s, box-shadow 0.3s;
}


/* --- Footer --- */
.bbdd-footer{
  padding:12px 16px; display:flex; align-items:center; gap:10px;
  border-top:1px solid var(--line);
  background: linear-gradient(180deg, rgba(18,22,45,.55), rgba(12,16,35,.55));
}

/* --- Scrollbars --- */
#table-wrap::-webkit-scrollbar{ width:10px; height:10px; }
#table-wrap::-webkit-scrollbar-thumb{
  background: rgba(122,134,255,.28);
  border-radius:10px;
  border:2px solid transparent;
  background-clip: padding-box;
}
#table-wrap::-webkit-scrollbar-track{ background: transparent; }

/* =========================
   RESPONSIVE
   ========================= */

/* ======= MOBILE (≤768px) ======= */
@media (max-width:768px){
  .bbdd-overlay{ align-items:stretch; padding:0; }
  .bbdd-panel{ width:100%; height:100vh; border-radius:0; }

  .bbdd-header{ padding:12px 14px; }
  .bbdd-header h1{ font-size:16px; }

  .bbdd-tools{
    top:52px;
    grid-template-columns: 1fr;
    gap:8px; padding:8px 12px;
  }
  .gj-info{ margin:12px 12px; padding:12px; border-radius:14px; font-size:14px; }

  /* El scroll general vive en el panel; el wrap queda visual */
  #table-wrap{
    overflow:visible; max-height:none; margin:0 12px 12px;
  }

  /* Mostrar solo columnas 4,5,6 con colgroup */
  #bbdd-table col.col-pilar,
  #bbdd-table col.col-rasgo,
  #bbdd-table col.col-stat,
  #bbdd-table col.col-eliminar{ width:0 !important; }

  #bbdd-table col.col-task       { width:64% !important; }
  #bbdd-table col.col-dificultad { width:18% !important; }
  #bbdd-table col.col-feedback   { width:18% !important; }

  /* Barra de títulos: 0 0 0 | Task | Dific | Feedback | 0 */
  .bbdd-columns{
    grid-template-columns: 0 0 0 1fr 0.28fr 0.28fr 0 !important;
  }
  .bbdd-columns > div:nth-child(1),
  .bbdd-columns > div:nth-child(2),
  .bbdd-columns > div:nth-child(3),
  .bbdd-columns > div:nth-child(7){
    visibility: hidden !important;
    height:0 !important; margin:0 !important; padding:0 !important; border:0 !important;
    pointer-events:none !important;
  }

  /* Toques de usabilidad móvil */
  .input, select{ padding:10px 12px; border-radius:12px; }
  .btn{ padding:10px 12px; border-radius:12px; }
  #bbdd-table tbody td:nth-child(4){ /* Tasks */
    max-width: 0; /* permite ellipsis dentro de layout fixed */
  }
}

/* ======= DESKTOP (≥769px) ======= */
@media (min-width:769px){
  .bbdd-columns{
    grid-template-columns:
      var(--w-pilar) var(--w-rasgo) var(--w-stat)
      var(--w-task) var(--w-dificultad) var(--w-feedback) var(--w-eliminar) !important;
  }
}

/* === MOBILE (≤768px) — solo 3 columnas visibles y sin scroll horizontal === */
@media (max-width:768px){

  /* 0) Evitar movimiento lateral */
  .bbdd-panel,
  #table-wrap{ overflow-x: hidden !important; }
  #bbdd-table{ width:100% !important; table-layout: fixed !important; }

  /* 1) Colapsar columnas 1,2,3 y 7 (ancho 0) */
  #bbdd-table col.col-pilar,
  #bbdd-table col.col-rasgo,
  #bbdd-table col.col-stat,
  #bbdd-table col.col-eliminar{ width:0 !important; }

  /* 2) OJO: además de colapsar el colgroup, ocultamos celdas/th para que
        su contenido NO empuje y no genere scroll horizontal */
  #bbdd-table thead th:nth-child(1),
  #bbdd-table thead th:nth-child(2),
  #bbdd-table thead th:nth-child(3),
  #bbdd-table thead th:nth-child(7),
  #bbdd-table tbody td:nth-child(1),
  #bbdd-table tbody td:nth-child(2),
  #bbdd-table tbody td:nth-child(3),
  #bbdd-table tbody td:nth-child(7){
    padding:0 !important;
    border:0 !important;
    width:0 !important; max-width:0 !important;
    overflow:hidden !important; white-space:nowrap !important;
    font-size:0 !important;   /* evita “fantasmas” de texto */
  }

  /* 3) Reparto de ancho SOLO entre las visibles (ajustá acá):
        - Más aire a Feedback, menos a Dificultad */
  #bbdd-table col.col-task       { width:62% !important; }
  #bbdd-table col.col-dificultad { width:16% !important; } /* ↓ antes 18% */
  #bbdd-table col.col-feedback   { width:22% !important; } /* ↑ antes 18% */

  /* 4) Barra fija de títulos: mismas proporciones y bordes como la toolbar */
  .bbdd-columns{
    grid-template-columns: 0 0 0 62% 16% 22% 0 !important;
    border-radius: 8px !important;         /* como la toolbar */
    margin: 6px 6px 0 !important;         /* alinear con padding lateral */
  }
}

/* === DESKTOP (≥769px) — todo vuelve a la normalidad === */
@media (min-width:769px){
  .bbdd-columns{
    grid-template-columns:
      var(--w-pilar) var(--w-rasgo) var(--w-stat)
      var(--w-task) var(--w-dificultad) var(--w-feedback) var(--w-eliminar) !important;
    border-radius: 8px; /* si querés que también acá se parezca a la toolbar */
  }
}
