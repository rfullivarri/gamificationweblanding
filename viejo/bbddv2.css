/* === Variables y resets === */
:root {
  --bg:#0b0f19;
  --ink:#e9eef7;
  --muted:#9aa3b2;
  --accent:#7d3cff;
  --accent2:#9a74ff;
  --card:#101726;
  --chip:#17203a;
  --border:#1d2743;
  --shadow:0 12px 28px rgba(0,0,0,.35);
  --tap:44px;
  --r:14px;
  --actionsw:180px;
  --appbarHide:0px;
  --appbarPad:0px;
  --overlay-scrim:.42;
  --panel-alpha:.73;
  --card-alpha:.79;
  --glass-soft:rgba(255,255,255,.06);
  --glass-stroke:rgba(255,255,255,.22);
  --confirm-w:clamp(160px,40vw,300px);
}
*,*::before,*::after{
  box-sizing:border-box;
}
html,body{
  height:100%;
  max-width:100%;
  overflow-x:hidden;
  overscroll-behavior-x:none;
  touch-action:pan-y;
}
body{
  margin:0;
  background:linear-gradient(180deg,#0b0f19 0%,#0d1324 100%);
  color:var(--ink);
  font:15px/1.4 "Inter",system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
  -webkit-font-smoothing:antialiased;
}
a{color:inherit;}
button,input,select{font:inherit;}
select,button{cursor:pointer;}
.hidden{display:none!important;}
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}

/* === Botones y campos === */
.btn{
  appearance:none;
  border:1px solid rgba(125,60,255,.25);
  background:var(--chip);
  color:var(--ink);
  min-height:var(--tap);
  border-radius:12px;
  padding:10px 14px;
  font-weight:600;
  transition:background .2s,border-color .2s,transform .2s;
}
.btn:hover{
  border-color:var(--accent2);
  background:rgba(125,60,255,.16);
}
.btn.icon{
  width:var(--tap);
  display:grid;
  place-items:center;
  padding:0;
  font-size:18px;
}
.btn.primary{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  box-shadow:0 10px 30px rgba(125,60,255,.35);
}
.btn.primary[disabled]{
  opacity:.55;
  cursor:progress;
  box-shadow:none;
}
details.guide{
  margin:12px 0;
  border:1px solid rgba(255,255,255,.18);
  border-radius:14px;
  background:var(--glass-soft);
  padding:10px 14px;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08),var(--shadow);
}
details.guide summary{
  cursor:pointer;
  color:#cfd6f8;
  font-weight:600;
}
details.guide ul{
  margin:10px 0 0 18px;
  color:var(--muted);
  padding:0 0 4px;
}
.tools{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  margin:10px 0 2px;
}
.left-tools{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.field{
  flex:1 1 220px;
  display:flex;
  align-items:center;
  gap:8px;
  min-height:42px;
  min-width:0;
  padding:0 12px;
  border-radius:12px;
  background:var(--glass-soft);
  border:1px solid rgba(255,255,255,.18);
}
.field input{
  flex:1;
  min-width:0;
  background:transparent;
  border:0;
  outline:0;
  color:var(--ink);
  font-size:15px;
}
.indicator{
  font-size:.78rem;
  color:#ffd166;
  display:flex;
  align-items:center;
  gap:6px;
}
.indicator.hidden{display:none!important;}
#bbdd-ai{
  position:relative;
  display:none!important;
}
#ai-sparkle{
  position:absolute;
  inset:-6px;
  pointer-events:none;
  background:radial-gradient(circle at top,var(--accent2),transparent 60%);
  opacity:0;
  animation:pulse 1.6s infinite;
}
.ai-loading #ai-sparkle{opacity:1;}

/* === Overlay modal y panel === */
#bbdd-overlay{
  position:fixed;
  inset:0;
  z-index:80;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:clamp(4px,0.8vh,8px);
  background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));
  backdrop-filter:blur(22px) saturate(160%) brightness(1.12);
  -webkit-backdrop-filter:blur(22px) saturate(160%) brightness(1.12);
  overflow-y:auto;
  overflow-x:hidden;
  overscroll-behavior:contain;
  touch-action:pan-y;
}
#bbdd-overlay::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(12,16,28,var(--overlay-scrim));
  z-index:0;
}
#bbdd-overlay > *{
  position:relative;
  z-index:1;
}
.bbdd-panel{
  width:min(960px,100%);
  height:100dvh;
  max-height:100dvh;
  display:flex;
  flex-direction:column;
  position:relative;
  overflow-y:auto;
  overflow-x:hidden;
  overscroll-behavior:contain;
  touch-action:pan-y;
  border-radius:14px;
  border:1px solid var(--glass-stroke);
  box-shadow:0 20px 50px rgba(24,28,50,.35);
  background:rgba(28,34,52,var(--panel-alpha));
}
.bbdd-panel::before{
  content:"";
  position:absolute;
  inset:-1px;
  border-radius:inherit;
  pointer-events:none;
  background:
    radial-gradient(600px 160px at 15% -10%,rgba(255,255,255,.15),transparent 60%),
    radial-gradient(600px 160px at 85% -10%,rgba(255,255,255,.12),transparent 60%);
}
.bbdd-panel[aria-busy="true"]{cursor:progress;}
.bbdd-panel.saving{
  position:relative;
}
.bbdd-panel.saving header.appbar,
.bbdd-panel.saving main,
.bbdd-panel.saving .bbdd-footer{
  pointer-events:none;
  user-select:none;
  opacity:.92;
  filter:grayscale(.1);
}
.bbdd-panel.saving #bbdd-confirm{
  pointer-events:auto;
}
#saving-shield{
  position:fixed;
  inset:0;
  z-index:55;
  background:transparent;
  display:none;
  touch-action:none;
  pointer-events:none;
}
.bbdd-panel.saving #saving-shield{
  display:block;
  pointer-events:auto;
  overscroll-behavior:contain;
}

/* === Cabecera y layout === */
header.appbar{
  position:sticky;
  top:0;
  z-index:30;
  padding:10px clamp(10px,3vw,18px) 8px;
  background:var(--glass-soft);
  border-bottom:1px solid rgba(255,255,255,.18);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08),var(--shadow);
  transform:translateY(calc(-1 * var(--appbarHide,0px)));
  transition:transform .16s ease;
  will-change:transform;
}
header.appbar.is-snapping{
  transition:transform .18s ease;
}
header.appbar .top-row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:8px;
  align-items:center;
}
header.appbar .top-row .primary{
  display:flex;
  align-items:center;
  gap:12px;
  flex:1 1 320px;
  min-width:0;
  flex-wrap:wrap;
}
header.appbar .top-row .primary .btn.icon{flex-shrink:0;}
header.appbar .title-wrap{flex:1 1 220px;min-width:0;}
header.appbar .title{font-weight:800;font-size:1.06rem;line-height:1.25;}
header.appbar .sub{font-size:.78rem;color:var(--muted);margin-top:2px;}
header.appbar .row-actions{
  display:flex;
  align-items:center;
  gap:8px;
  margin-left:auto;
  flex-wrap:wrap;
  min-width:0;
  flex:0 0 auto;
  position:relative;
}
header.appbar .row-actions .btn{
  white-space:nowrap;
  flex:0 0 auto;
}
.bbdd-panel > main{
  flex:1 1 auto;
  overflow:visible;
  position:relative;
  scroll-behavior:smooth;
  padding:calc(var(--appbarPad,0px)) clamp(8px,2.4vw,14px) clamp(90px,12vh,150px);
}
.thead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  color:var(--muted);
  font-size:.78rem;
  margin:6px 2px 0;
  gap:8px;
}
.thead .label{flex:1 1 auto;min-width:0;}
.thead .add{
  min-height:36px;
  padding:0 12px;
  border-radius:10px;
  background:rgba(125,60,255,.16);
  border-color:rgba(125,60,255,.4);
}
#table-wrap{position:relative;}
#bbdd-table{
  width:100%;
  border-collapse:collapse;
}
#bbdd-table colgroup,
#bbdd-table thead{
  display:none;
}
#bbdd-table tbody tr{display:table-row;}
#bbdd-table td{
  border:0;
  padding:0;
  background:transparent;
}
#table-wrap,
#bbdd-table{
  max-width:100%;
  overflow-x:hidden;
}
#add-row-dup{
  display:none;
  align-items:center;
  justify-content:center;
  padding:0 12px;
}
#status-msg{
  flex:1;
  color:#9ff7cc;
  font-size:.82rem;
  transition:opacity .2s;
}
.bbdd-footer{
  position:sticky;
  bottom:0;
  z-index:15;
  display:flex;
  align-items:center;
  gap:10px;
  padding:14px clamp(14px,4vw,24px) calc(env(safe-area-inset-bottom)+18px);
  background:linear-gradient(180deg,rgba(11,16,28,.1) 0%,rgba(11,16,28,.88) 45%,rgba(11,16,28,.98) 100%);
}
.bbdd-footer .btn{min-height:42px;}

/* === Indicadores de carga === */
#table-spinner{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:12px;
  background:rgba(8,12,24,.82);
  color:var(--ink);
  font-weight:600;
  z-index:120;
  pointer-events:auto;
}
#table-wrap.table-loading #table-spinner{display:flex;}
#table-spinner .ring{
  width:36px;
  height:36px;
  border-radius:50%;
  border:3px solid rgba(125,60,255,.18);
  border-top-color:var(--accent2);
  animation:spin .9s linear infinite;
}
#ai-overlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-centerdascenter;
  background:rgba(7,12,26,.82);
  color:#cfd7ff;
  font-weight:600;
  z-index:130;
  gap:10px;
}
#ai-overlay .spark{
  font-size:1.4rem;
  animation:twinkle 1.6s ease-in-out infinite;
}
.ai-loading #ai-overlay{display:flex;}

/* === Botón flotante de confirmación === */
#bbdd-confirm{
  position:fixed;
  right:clamp(10px,3vw,20px);
  top:calc(env(safe-area-inset-top,0px) + 10px);
  z-index:60;
  width:var(--confirm-w);
  box-shadow:0 14px 34px rgba(125,60,255,.35);
  overflow:visible;
  pointer-events:auto;
}
#bbdd-confirm.is-busy{
  color:transparent;
  pointer-events:none;
  opacity:.95;
}
#bbdd-confirm.is-busy::after{
  content:"";
  position:absolute;
  inset:0;
  margin:auto;
  width:18px;
  height:18px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.35);
  border-top-color:#fff;
  animation:btnspin .8s linear infinite;
}

/* === Listado de tareas === */
.item{
  position:relative;
  margin:6px 0;
  border-radius:14px;
  overflow:hidden;
  touch-action:pan-y;
}
.item .actions{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
  padding-right:10px;
  min-width:var(--actionsw);
  opacity:0;
  pointer-events:none;
  background:transparent;
  transition:opacity .18s ease,background .18s ease;
}
.item .actions .act{
  width:46px;
  height:46px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.24rem;
  font-weight:700;
  color:#fff;
  border:1px solid transparent;
  background:transparent;
  box-shadow:none;
  opacity:0;
  transform:translateX(12px);
  transition:opacity .18s ease,background .18s ease,border-color .18s ease,transform .18s ease;
}
.item .act.modify{border-color:#2b8fdb;background:rgba(26,48,78,.88);}
.item .act.improve{border-color:#8c5cff;background:rgba(39,28,78,.9);}
.item .act.del{border-color:#e74c3c;background:rgba(64,20,28,.92);}
.item.row-peek .actions{
  background:linear-gradient(90deg,transparent 55%,rgba(10,14,28,.5) 100%);
  opacity:.6;
}
.item.row-peek .actions .act{
  opacity:.35;
  background:rgba(32,38,66,.25);
  border-color:rgba(125,60,255,.18);
  box-shadow:none;
  transform:translateX(0);
}
.item.row-open .actions{
  opacity:1;
  pointer-events:auto;
  background:linear-gradient(90deg,transparent 32%,rgba(10,14,28,.88) 100%);
}
.item.row-open .actions .act{
  opacity:1;
  box-shadow:0 6px 18px rgba(0,0,0,.32);
  transform:translateX(0);
}
.slidable{
  position:relative;
  display:grid;
  grid-template-columns:var(--mark-w,4px) 1fr auto auto;
  align-items:center;
  column-gap:6px;
  padding:8px 10px;
  background:rgba(18,24,40,var(--card-alpha));
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  transition:transform .18s ease,border-color .18s ease,box-shadow .18s ease;
  will-change:transform;
  box-shadow:var(--shadow);
  touch-action:pan-x pan-y;
}
.slidable .mark{
  grid-column:1;
  align-self:stretch;
  width:var(--mark-w,4px);
  border-radius:999px;
  background:linear-gradient(180deg,#2a7fff,#7d3cff);
}
.slidable .content{
  grid-column:2;
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.row-main{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.task-input{
  flex:1 1 auto;
  min-width:0;
  width:100%;
  padding:7px 9px;
  border-radius:10px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.22);
  color:var(--ink);
}
.task-input.ai-updated{
  border-color:#71e6b5;
  box-shadow:0 0 0 1px rgba(113,230,181,.35);
}
.task-input::placeholder{color:rgba(233,238,247,.35);}
.slidable .diff-chip{
  grid-column:3;
  white-space:nowrap;
  padding:0 10px;
  height:34px;
}
.slidable .more{
  grid-column:4;
  width:44px;
  min-width:44px;
  height:34px;
  font-size:20px;
}
.diff-chip,.more{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  height:34px;
  border-radius:11px;
  border:1px solid rgba(125,60,255,.22);
  background:rgba(22,30,50,.92);
  color:var(--ink);
}
.diff-chip .dot{
  width:10px;
  height:10px;
  border-radius:99px;
  background:#8a93a7;
}
.diff-chip[data-v="Fácil"] .dot{background:#2ecc71;}
.diff-chip[data-v="Media"] .dot{background:#f1c40f;}
.diff-chip[data-v="Difícil"] .dot{background:#e74c3c;}
.item.expanded .more{
  background:rgba(125,60,255,.2);
  border-color:rgba(125,60,255,.5);
}
.meta{
  display:grid;
  gap:8px;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.18);
  border-radius:12px;
  padding:8px;
  opacity:0;
  max-height:0;
  overflow:hidden;
  transition:opacity .18s ease,max-height .18s ease;
}
.item.expanded .meta{
  opacity:1;
  max-height:460px;
}
.meta label{
  display:flex;
  flex-direction:column;
  font-size:.74rem;
  color:var(--muted);
  gap:6px;
}
.meta select,
.meta input{
  width:100%;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.18);
  border-radius:10px;
  min-height:36px;
  padding:6px 10px;
  color:var(--ink);
}
.meta input::placeholder{color:rgba(233,238,247,.3);}
.meta .feedback{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-start;
  grid-column:1 / -1;
}
.meta .feedback button{
  width:40px;
  height:40px;
  border-radius:10px;
  border:1px solid rgba(125,60,255,.28);
  background:rgba(24,32,52,.9);
  color:var(--ink);
  font-size:1.1rem;
  display:flex;
  align-items:center;
  justify-content:center;
}
.item:not(.expanded) .meta .feedback{display:none;}
.meta-actions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
  grid-column:1 / -1;
}
.meta-actions .meta-btn{
  flex:1 1 120px;
  min-height:36px;
  border-radius:10px;
  border:1px solid rgba(125,60,255,.22);
  background:rgba(18,28,48,.88);
  color:var(--ink);
  font-weight:600;
  font-size:.82rem;
  padding:6px 10px;
  display:flex;
  align-items:center;
  gap:8px;
  justify-content:center;
}
.meta-actions .meta-btn.danger{
  border-color:#e74c3c;
  color:#ffb1b8;
  background:rgba(56,20,32,.92);
}
.item.swipe-hint .slidable{
  animation:swipe-hint 2.6s ease-in-out infinite;
}
.item.ai-improved .slidable{
  border-color:rgba(140,92,255,.65);
  box-shadow:0 0 0 1px rgba(140,92,255,.35),0 14px 34px rgba(83,57,168,.35);
}
.item.ai-modified .slidable{
  border-color:rgba(113,230,181,.8);
  box-shadow:0 0 0 1px rgba(113,230,181,.35),0 14px 34px rgba(36,126,104,.3);
}

/* === Estados de foco === */
.slidable:has(.task-input:focus){
  border-color:#71e6b5;
  box-shadow:0 0 0 1px rgba(113,230,181,.45),0 14px 34px rgba(36,126,104,.28);
}
.task-input:focus{
  outline:0;
  border-color:#71e6b5;
  box-shadow:0 0 0 2px rgba(113,230,181,.3);
}

/* === Media queries === */
@media (min-width:780px){
  body{background:#060912;}
  header.appbar{padding:18px 40px 14px;}
  .bbdd-panel > main{
    padding:calc(var(--appbarPad,0px)) 40px 180px;
  }
  .item{margin:12px 0;}
  .slidable{
    column-gap:16px;
    padding:14px 16px;
  }
  .meta{
    grid-template-columns:repeat(3,minmax(160px,1fr));
  }
}
@media (max-width:720px){
  header.appbar .top-row{align-items:flex-start;}
  header.appbar .top-row .primary{
    width:100%;
    align-items:flex-start;
  }
  header.appbar .top-row .primary .title-wrap{flex-basis:100%;}
  header.appbar .top-row .row-actions{
    width:100%;
    margin-left:0;
    justify-content:flex-end;
  }
  header.appbar .top-row .row-actions .btn{
    flex:1;
    min-width:0;
  }
  .tools{
    flex-direction:column;
    align-items:stretch;
    gap:8px;
  }
  .left-tools{width:100%;justify-content:flex-start;}
  .field{width:100%;}
  #bbdd-ai{width:100%;}
  #add-row{display:none;}
  #add-row-dup{display:inline-flex;}
  .meta{grid-template-columns:repeat(auto-fit,minmax(120px,1fr));}
}
@media (max-width:520px){
  .bbdd-panel > main{
    padding-top:calc(var(--appbarPad,0px) + 56px);
  }
  #bbdd-confirm{
    left:auto;
    right:12px;
  }
  .btn.primary{min-width:160px;}
  .meta-actions .meta-btn{flex:1 1 100%;}
}
@media (max-width:480px){
  .slidable{column-gap:8px;}
  .slidable .diff-chip{padding:0 8px;}
  .slidable .more{
    width:40px;
    min-width:40px;
  }
  .task-input{padding:6px 8px;}
}
@media (max-width:420px){
  header.appbar{padding:8px 10px;}
  .bbdd-panel > main{
    padding-left:8px;
    padding-right:8px;
  }
  .slidable{
    padding:7px 8px;
    column-gap:5px;
  }
}
@media (max-width:380px){
  .slidable{column-gap:6px;}
  .slidable .diff-chip{
    padding:0 6px;
    font-size:.92rem;
  }
  .slidable .more{
    width:36px;
    min-width:36px;
  }
}

/* === Animaciones === */
@keyframes pulse{0%,100%{opacity:.1;}50%{opacity:.45;}}
@keyframes swipe-hint{
  0%,60%,100%{transform:translateX(0);}
  25%{transform:translateX(calc(-1 * var(--actionsw) * .55));}
  45%{transform:translateX(0);}
}
@keyframes twinkle{0%,100%{opacity:.4;transform:scale(1);}50%{opacity:1;transform:scale(1.2);}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes btnspin{to{transform:rotate(360deg);}}
