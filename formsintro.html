<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Self-Improvement Journey</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0e19; --panel:#141a2c; --card:#171b31; --ring:rgba(255,255,255,.08);
    --text:#eaf0ff; --muted:#a9b2d0; --accent:#7a66ff; --accent2:#a78bfa; --ok:#38d39f;
    --shadow:0 24px 80px rgba(0,0,0,.40);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Rubik',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1100px 700px at 50% -15%, rgba(122,102,255,.18), transparent 60%),
      linear-gradient(180deg, #0b0e19, #0b0e19 30%, #0f1325 100%);
    overflow:hidden;
  }

  /* HUD */
  .hud{
    position:fixed; inset:0 0 auto 0; z-index:20;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:10px 12px; background:rgba(10,12,24,.86); border-bottom:1px solid var(--ring);
    backdrop-filter: blur(4px);
  }
  .hud-left{display:flex; align-items:center; gap:12px}
  .brand{display:flex; align-items:center; gap:9px; font-weight:800}
  .dot{width:9px; height:9px; border-radius:50%; background:var(--accent); box-shadow:0 0 20px var(--accent)}
  .progress{width:200px; height:8px; background:#0f1430; border-radius:6px; overflow:hidden}
  .progress .fill{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2))}
  .bars{display:flex; align-items:center; gap:14px}
  .pill{display:flex; flex-direction:column; gap:4px; font-size:12px; min-width:110px}
  .pill .row{display:flex; align-items:center; gap:6px}
  .pill .emoji{font-size:14px}
  .pill .label{font-weight:600}
  progress{width:120px; height:8px; background:#0f1430; border-radius:6px}
  progress::-webkit-progress-bar{background:#0f1430; border-radius:6px}
  progress::-webkit-progress-value{border-radius:6px; background:linear-gradient(90deg,#6d78ff,#a78bfa)}
  .total{font-weight:800; letter-spacing:.2px}

  /* HUD compacto m√≥vil (vertical) */
  @media (max-width:520px){
    .progress{width:120px}
    .bars{gap:8px}
    .pill{min-width:auto}
    progress{width:70px}
  }
  @media (max-width:430px){
    .brand span:last-child{display:none}
    .progress{width:90px}
    .pill .label{display:none}
    .pill{min-width:auto}
    progress{width:58px}
  }

  /* Overlay */
  .overlay{position:fixed; inset:48px 0 0 0; display:flex; align-items:center; justify-content:center;}
  .modal{
    width:min(980px,94vw); max-height:calc(100vh - 64px); background:rgba(20,24,44,.78);
    border:1px solid var(--ring); border-radius:18px; box-shadow:var(--shadow); overflow:hidden;
    display:grid; grid-template-rows:auto 1fr;
  }

  /* Screens */
  .scr{display:none; padding:20px; overflow:auto}
  .scr.active{display:block}
  .hero{display:grid; grid-template-columns: 1fr .9fr; gap:20px; align-items:center}
  @media (max-width:980px){ .hero{grid-template-columns:1fr} }
  .pic{border-radius:14px; border:1px solid var(--ring); overflow:hidden; background:#10142b; aspect-ratio:4/3}
  .pic img{width:100%; height:100%; object-fit:cover; display:block; opacity:.95}

  h1,h2{margin:8px 0 8px}
  p{margin:6px 0 10px; color:#cbd3ff; line-height:1.65}
  .note{color:#aab7ff; font-size:13px}
  .xp-badge{display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px;
    background:#101433; border:1px solid var(--ring); margin:6px 0 0}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:12px 0}
  .card{background:#171b31; border:1px solid var(--ring); border-radius:14px; padding:14px; cursor:pointer;
    transition:transform .12s ease, background .12s ease;}
  .card:hover{transform:translateY(-2px)}
  .card.selected{background:rgba(122,102,255,.22); border-color:rgba(122,102,255,.45)}
  .checklist{display:grid; gap:10px; margin:12px 0}
  .chip{display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:10px;
    border:1px solid var(--ring); background:rgba(255,255,255,.04)}
  textarea, input[type="text"], input[type="email"]{
    width:100%; padding:12px; border-radius:12px; border:1px solid var(--ring);
    background:rgba(255,255,255,.05); color:#fff; outline:none;
  }
  .counter{font-size:13px; color:#c7cff1; margin-top:6px}
  .nav{display:flex; justify-content:space-between; gap:8px; margin-top:12px}
  .btn{background:#7a66ff; border:0; color:#fff; font-weight:800; padding:10px 16px; border-radius:10px; cursor:pointer}
  .btn.secondary{background:transparent; border:1px solid var(--ring)}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .toast{
    position:absolute; right:12px; bottom:12px; background:#111a39; border:1px solid var(--ring);
    padding:8px 10px; border-radius:9px; font-size:13px; color:#cfe0ff; opacity:0; transform:translateY(6px);
    transition:.2s ease;
  }
  .toast.show{opacity:1; transform:none}
  .summary-box{background:rgba(255,255,255,.05); border:1px solid var(--ring); border-radius:14px; padding:12px}
</style>
</head>
<body>

<!-- HUD -->
<div class="hud">
  <div class="hud-left">
    <div class="brand"><span class="dot"></span> <span>Journey</span></div>
    <div class="progress"><div id="progressFill" class="fill"></div></div>
  </div>
  <div class="bars">
    <div class="pill">
      <div class="row"><span class="emoji">ü´Ä</span><span class="label">Body</span></div>
      <progress id="barBody" value="0" max="100"></progress>
    </div>
    <div class="pill">
      <div class="row"><span class="emoji">üß†</span><span class="label">Mind</span></div>
      <progress id="barMind" value="0" max="100"></progress>
    </div>
    <div class="pill">
      <div class="row"><span class="emoji">üèµÔ∏è</span><span class="label">Soul</span></div>
      <progress id="barSoul" value="0" max="100"></progress>
    </div>
  </div>
  <div class="total">XP: <span id="xpTotal">0</span></div>
</div>

<!-- Overlay -->
<div class="overlay">
  <div class="modal">

    <!-- Intro -->
    <section class="scr active" id="scr-intro">
      <div class="hero">
        <div>
          <h2>Cap. 0 ‚Äî El Despertar</h2>
          <p>
            Respir√°. Hoy encend√©s tu sistema de mejora. Te voy guiando para equilibrar <strong>Cuerpo, Mente y Alma</strong> con pasos simples.
            <br><br><strong>C√≥mo funciona:</strong> por cada pregunta que completes vas a ir sumando puntos de experiencia  <strong>(XP)</strong>.
            Algunas valen <em>+21 XP</em> (respuestas escritas o clave de modo) y otras <em>+13 XP</em> (selecciones). Arriba vas a ver c√≥mo se carga tu XP total y el de cada pilar.
          </p>

          <!-- Email (obligatorio) -->
          <div class="field" style="margin:12px 0">
            <label for="emailInput">Tu correo (obligatorio)</label>
            <input id="emailInput" type="email" placeholder="tu@email.com" required>
            <small style="color:#aab7ff">Lo usamos para crear tu tablero y guardar tu progreso.</small>
          </div>

          <div class="nav">
            <button class="btn secondary" id="backIntro" disabled>‚Äî</button>
            <button class="btn" id="goModes" disabled>Entrar</button>
          </div>
        </div>
        <figure class="pic"><img src="https://i.ibb.co/vCJSp395/761-EAF33-3-AD7-444-E-96-F7-EB58-AC9-D8-F32.png" alt="Intro"></figure>
      </div>
    </section>

    <!-- Game Modes -->
    <section class="scr" id="scr-modes">
      <div class="hero">
        <div>
          <h2>Eleg√≠ tu Game Mode</h2>
          <p>Eleg√≠ el <strong>modo</strong> que mejor describe tu estado <strong>hoy</strong> para adaptar el recorrido a tu energ√≠a y enfoque.</p>
          <div class="grid" id="modeGrid">
            <div class="card" data-mode="LOW"><h3>LOW MOOD</h3><p class="note">Energ√≠a baja. Activamos tu m√≠nimo vital con acciones peque√±as y seguras.</p></div>
            <div class="card" data-mode="CHILL"><h3>CHILL MOOD</h3><p class="note">Tranquilo / estable. Sostener bienestar con rutinas suaves y balance.</p></div>
            <div class="card" data-mode="FLOW"><h3>FLOW MOOD</h3><p class="note">Enfocado. Alineamos tu impulso con una meta clara sin descuidar el bienestar.</p></div>
            <div class="card" data-mode="EVOLVE"><h3>EVOLVE MOOD</h3><p class="note">Ambici√≥n con prop√≥sito. Subimos de nivel con misiones y foco sostenible.</p></div>
          </div>
          <div class="nav">
            <button class="btn secondary" id="backIntro">Volver</button>
            <button class="btn" id="confirmMode" disabled>Confirmar modo</button>
          </div>
        </div>
        <figure class="pic"><img src="https://i.ibb.co/Kpw8p1Hh/E57389-B9-DBF2-4-F97-B24-F-E740-C067-A688.png" alt="Modos"></figure>
      </div>
    </section>

    <!-- ====== LOW (sin Foundations) -->
    <section class="scr" id="scr-low-body" data-type="checklist" data-pillar="Body" data-xp="13" data-limit="5">
      <h2>LOW ¬∑ ü´Ä Body</h2>
      <p>Eleg√≠ hasta <strong>5</strong> acciones simples que te har√≠an bien ahora. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="lowBodyList"></div>
      <div class="counter"><span id="lowBodyCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backToModes1">Volver</button>
        <button class="btn" id="confirmLowBody" disabled>Confirmar</button>
      </div>
    </section>

    <section class="scr" id="scr-low-soul" data-type="checklist" data-pillar="Soul" data-xp="13" data-limit="5">
      <h2>LOW ¬∑ üèµÔ∏è Soul</h2>
      <p>Eleg√≠ hasta <strong>5</strong> cosas simples que te conectan con vos. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="lowSoulList"></div>
      <div class="counter"><span id="lowSoulCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backLowBody">Volver</button>
        <button class="btn" id="confirmLowSoul" disabled>Confirmar</button>
      </div>
    </section>

    <section class="scr" id="scr-low-mind" data-type="checklist" data-pillar="Mind" data-xp="13" data-limit="5">
      <h2>LOW ¬∑ üß† Mind</h2>
      <p>Eleg√≠ hasta <strong>5</strong> acciones mentales que te ayuden hoy. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="lowMindList"></div>
      <div class="counter"><span id="lowMindCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backLowSoul">Volver</button>
        <button class="btn" id="confirmLowMind" disabled>Confirmar</button>
      </div>
    </section>

    <!-- Low ¬∑ comentario final (opcional, 0 XP) -->
    <section class="scr" id="scr-low-note" data-type="open0">
      <h2>LOW ¬∑ ¬øQuer√©s contarnos algo m√°s?</h2>
      <p class="note">Es personal: solo una IA lo revisar√°. Pod√©s dejarlo en blanco si no quer√©s.</p>
      <textarea id="lowNote" rows="4" placeholder="(opcional)"></textarea>
      <div class="nav">
        <button class="btn secondary" id="backLowMind">Volver</button>
        <button class="btn" id="confirmLowNote">Continuar</button>
      </div>
    </section>

    <!-- ====== CHILL (luego Foundations) -->
    <section class="scr" id="scr-chill-open" data-type="open21">
      <div class="hero">
        <div>
          <h2>CHILL ¬∑ Una cosa este mes</h2>
          <p>Si pudieras mejorar o lograr <strong>solo una cosa</strong> este mes, ¬øcu√°l ser√≠a? <span class="xp-badge">+21 XP</span></p>
          <textarea id="chillOneThing" rows="4" placeholder="Escrib√≠ tu respuesta‚Ä¶ (obligatoria)"></textarea>
          <div class="nav">
            <button class="btn secondary" id="backToModes2">Volver</button>
            <button class="btn" id="confirmChillOpen" disabled>Confirmar</button>
          </div>
        </div>
        <figure class="pic"><img src="https://i.ibb.co/WpcbX5vy/0817080-B-6816-4-F5-B-B7-DC-0-AC9-E9-E28657.png" alt="Chill"></figure>
      </div>
    </section>

    <section class="scr" id="scr-chill-motiv" data-type="mode13">
      <h2>CHILL ¬∑ ¬øQu√© te impulsa m√°s?</h2>
      <p>Eleg√≠ las que sientas (al menos una). <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="chillMotivList"></div>
      <div class="nav">
        <button class="btn secondary" id="backChillOpen">Volver</button>
        <button class="btn" id="confirmChillMotiv" disabled>Confirmar</button>
      </div>
    </section>

    <!-- ====== FLOW (luego Foundations) -->
    <section class="scr" id="scr-flow-goal" data-type="open21">
      <div class="hero">
        <div>
          <h2>FLOW ¬∑ Tu objetivo</h2>
          <p>¬øCu√°l es tu objetivo en este momento? <span class="xp-badge">+21 XP</span></p>
          <textarea id="flowGoal" rows="4" placeholder="Escrib√≠ tu objetivo‚Ä¶ (obligatorio)"></textarea>
          <div class="nav">
            <button class="btn secondary" id="backToModes3">Volver</button>
            <button class="btn" id="confirmFlowGoal" disabled>Confirmar</button>
          </div>
        </div>
        <figure class="pic"><img src="https://i.ibb.co/WpcbX5vy/0817080-B-6816-4-F5-B-B7-DC-0-AC9-E9-E28657.png" alt="Flow"></figure>
      </div>
    </section>

    <section class="scr" id="scr-flow-imped" data-type="mode13">
      <h2>FLOW ¬∑ ¬øQu√© te lo viene impidiendo?</h2>
      <p>Eleg√≠ las que apliquen (al menos una). <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="flowImpedList"></div>
      <div class="nav">
        <button class="btn secondary" id="backFlowGoal">Volver</button>
        <button class="btn" id="confirmFlowImped" disabled>Confirmar</button>
      </div>
    </section>

    <!-- ====== EVOLVE (luego Foundations) -->
    <section class="scr" id="scr-evolve-goal" data-type="open21">
      <div class="hero">
        <div>
          <h2>EVOLVE ¬∑ Objetivo desafiante</h2>
          <p>¬øCu√°l es tu objetivo desafiante? <span class="xp-badge">+21 XP</span></p>
          <textarea id="evolveGoal" rows="4" placeholder="Escrib√≠ tu objetivo‚Ä¶ (obligatorio)"></textarea>
          <div class="nav">
            <button class="btn secondary" id="backToModes4">Volver</button>
            <button class="btn" id="confirmEvolveGoal" disabled>Confirmar</button>
          </div>
        </div>
        <figure class="pic"><img src="https://i.ibb.co/WpcbX5vy/0817080-B-6816-4-F5-B-B7-DC-0-AC9-E9-E28657.png" alt="Evolve"></figure>
      </div>
    </section>

    <section class="scr" id="scr-evolve-trade" data-type="mode13">
      <h2>EVOLVE ¬∑ ¬øQu√© est√°s dispuesto a ajustar?</h2>
      <p>Eleg√≠ las que apliquen (al menos una). <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="evolveTradeList"></div>
      <div class="nav">
        <button class="btn secondary" id="backEvolveGoal">Volver</button>
        <button class="btn" id="confirmEvolveTrade" disabled>Confirmar</button>
      </div>
    </section>

    <section class="scr" id="scr-evolve-att" data-type="mode21-radio">
      <h2>EVOLVE ¬∑ Actitud ante el cambio</h2>
      <p>Eleg√≠ una opci√≥n. <span class="xp-badge">+21 XP</span></p>
      <div class="checklist" id="evolveAttList"></div>
      <div class="nav">
        <button class="btn secondary" id="backEvolveTrade">Volver</button>
        <button class="btn" id="confirmEvolveAtt" disabled>Confirmar</button>
      </div>
    </section>

    <!-- ====== FOUNDATIONS (10 por pilar, m√°x 5) -->
    <section class="scr" id="scr-f-body" data-type="checklist" data-pillar="Body" data-xp="13" data-limit="5">
      <h2>Foundations ¬∑ ü´Ä Body</h2>
      <p>Lo f√≠sico es tu base. Eleg√≠ hasta <strong>5</strong> anclas. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="fBodyList"></div>
      <div class="counter"><span id="fBodyCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backFoundPrev1">Volver</button>
        <button class="btn" id="confirmFBody" disabled>Confirmar</button>
      </div>
    </section>

    <section class="scr" id="scr-f-soul" data-type="checklist" data-pillar="Soul" data-xp="13" data-limit="5">
      <h2>Foundations ¬∑ üèµÔ∏è Soul</h2>
      <p>Sin centro, no hay llegada. Eleg√≠ hasta <strong>5</strong> pr√°cticas. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="fSoulList"></div>
      <div class="counter"><span id="fSoulCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backFBody">Volver</button>
        <button class="btn" id="confirmFSoul" disabled>Confirmar</button>
      </div>
    </section>

    <section class="scr" id="scr-f-mind" data-type="checklist" data-pillar="Mind" data-xp="13" data-limit="5">
      <h2>Foundations ¬∑ üß† Mind</h2>
      <p>No es hacer m√°s: es <strong>hacer mejor</strong>. Eleg√≠ hasta <strong>5</strong> focos. <span class="xp-badge">+13 XP</span></p>
      <div class="checklist" id="fMindList"></div>
      <div class="counter"><span id="fMindCount">0</span>/5 seleccionadas (obligatorio)</div>
      <div class="nav">
        <button class="btn secondary" id="backFSoul">Volver</button>
        <button class="btn" id="confirmFMind" disabled>Confirmar</button>
      </div>
    </section>

    <!-- ====== RESUMEN -->
    <section class="scr" id="scr-summary">
      <h2>¬°Listo para empezar en serio! üöÄ</h2>
      <div class="summary-box" id="summaryBox"></div>
      <p class="note" style="margin-top:10px">
        <strong>Capit√°n</strong>, con esto generamos tus <strong>primeras tasks</strong> y un plan simple para hoy.
        Vas a poder ver tu avance y reacomodar prioridades en tu <strong>tablero personal</strong>, pero lo importante es el <em>ritmo</em>: pasos cortos, XP real, progreso visible.
      </p>
      <div class="nav">
        <button class="btn secondary" id="restart">Volver al inicio</button>
        <button class="btn" id="finish">Comenzar Journey</button>
      </div>
      <div class="note" style="margin-top:8px">/* TODO: POST a Google Forms con tus <code>entry.xxx</code> */</div>
    </section>

    <div id="toast" class="toast">+13 XP</div>
  </div>
</div>

<script>
(() => {
  // ====== Estado ======
  const xp = { Body:0, Mind:0, Soul:0, total:0 };
  const answers = {
    email:"",              // ‚Üê agregado
    mode:null,
    low:{ body:[], soul:[], mind:[], note:"" },
    chill:{ oneThing:"", motiv:[] },
    flow:{ goal:"", imped:[] },
    evolve:{ goal:"", trade:[], att:"" },
    foundations:{ body:[], soul:[], mind:[] }
  };
  const routes = {
    LOW: ["scr-low-body","scr-low-soul","scr-low-mind","scr-low-note","scr-summary"],
    CHILL: ["scr-chill-open","scr-chill-motiv","scr-f-body","scr-f-soul","scr-f-mind","scr-summary"],
    FLOW: ["scr-flow-goal","scr-flow-imped","scr-f-body","scr-f-soul","scr-f-mind","scr-summary"],
    EVOLVE:["scr-evolve-goal","scr-evolve-trade","scr-evolve-att","scr-f-body","scr-f-soul","scr-f-mind","scr-summary"]
  };
  let routeScreens = []; let stepIndex = 0;

  // ====== Helpers ======
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));
  const $go = id => document.getElementById(id);
  const show = id => { $$(".scr").forEach(s=>s.classList.remove("active")); $("#"+id).classList.add("active"); drawProgress(); };
  const toast = (txt) => { const t=$("#toast"); t.textContent=txt; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1100); };
  function drawProgress(){
  // % de avance
  const total = routeScreens.length || 1;
  const pct = Math.min(100, Math.round((stepIndex)/(total-1)*100));
  $("#progressFill").style.width = pct + "%";

  // XP mostrado (redondeado) y barras
  const b = Math.round(xp.Body);
  const m = Math.round(xp.Mind);
  const s = Math.round(xp.Soul);

  $("#barBody").value = Math.min(b, 100);
  $("#barMind").value = Math.min(m, 100);
  $("#barSoul").value = Math.min(s, 100);

  // Total mostrado = suma de los tres mostrados
  const shownTotal = b + m + s;
  $("#xpTotal").textContent = shownTotal;

  // Mantener xp.total sincronizado con lo que se muestra
  xp.total = shownTotal;
}

  function addXP(amount, pillar){
  if (amount <= 0) return;

  // Fix precisi√≥n y total consistente
  const fix = n => Math.round(n * 100) / 100;

  if (pillar === "ALL") {
    ["Body","Mind","Soul"].forEach(p => {
      xp[p] = fix(xp[p] + amount / 3);
    });
  } else {
    xp[pillar] = fix(xp[pillar] + amount);
  }

  // El total SIEMPRE es la suma de los pilares (evita 107 vs 108)
  xp.total = fix(xp.Body + xp.Mind + xp.Soul);

  drawProgress();
}

  // ====== Contenido (listas) ======
  const lists = {
    lowBody:["Dormir mejor üò¥","Alimentarte mejor ü•ó","Moverte un poco m√°s üèÉ","Tomar m√°s agua üíß","Descansar sin culpa üßò"],
    lowSoul:["Respirar profundo üå¨Ô∏è","Escuchar m√∫sica üé∂","Naturaleza üçÉ","Anotar lo que sent√≠s üìù","Hacer algo sin tener que ser √∫til üåà"],
    lowMind:["Leer algo corto üìñ","Anotar tus pensamientos üìì","Mirar una serie tranquila üì∫","Pausa sin pantallas üö´üì±","Desarmar idea negativa üß©"],
    fBody:[
      "Actividad f√≠sica regular (Energ√≠a) üèÉ","Alimentaci√≥n saludable (Nutrici√≥n) ü•ó","Dormir y descansar mejor (Sue√±o) üò¥",
      "Relajaci√≥n y pausas (Recuperaci√≥n) üõÄ","Tomar m√°s agua (Hidrataci√≥n) üíß","Higiene y cuidado personal (Higiene) üßº",
      "M√°s energ√≠a al despertar (Vitalidad) üîÜ","Mejorar postura / ergonom√≠a (Postura) üßç‚Äç‚ôÇÔ∏è","Flexibilidad y movilidad (Movilidad) üßò‚Äç‚ôÄÔ∏è",
      "Reducir alcohol/tabaco/cafe√≠na (Moderaci√≥n) üö´"
    ],
    fSoul:[
      "Fortalecer v√≠nculos (Conexi√≥n) ü§ù","Practicar espiritualidad / plenitud ‚ú®","Definir prop√≥sito (Prop√≥sito) üéØ",
      "Vivir alineado a valores (Valores) ‚öñÔ∏è","Ayudar a otros / causa (Altruismo) üíó","Conocerte m√°s (Insight) üîç",
      "Practicar gratitud / actitud positiva (Gratitud) üôè","Conectarte con la naturaleza (Naturaleza) üå≥",
      "Jugar y divertirte sin culpa (Gozo) üéâ","Autoestima y auto-habla amable (Autoestima) üíé"
    ],
    fMind:[
      "Mejorar enfoque / productividad (Enfoque) üéØ","Aprender / estudiar mejor (Aprendizaje) üìö","Creatividad e ideas (Creatividad) üé®",
      "Manejar estr√©s o ansiedad (Gesti√≥n) üòå","Regular emociones (Autocontrol) üß†","Ser m√°s resiliente (Resiliencia) üí™",
      "M√°s orden mental (Orden) üóÇÔ∏è","Avanzar en carrera / proyectos (Profesional) üìà","H√°bitos financieros (Finanzas) üí∞",
      "Memoria y agilidad (Agilidad) üß©"
    ],
    chillMotiv:[
      "üå± Crecer como persona / desarrollo personal","üéØ Lograr metas concretas que me propongo",
      "ü§ù Sentirme m√°s conectado con otras personas","üßò‚Äç‚ôÇÔ∏è Vivir con m√°s calma y menos estr√©s",
      "üèÜ Superarme y romper mis l√≠mites","üõ†Ô∏è Crear o construir algo (proyectos, arte, emprendimientos)",
      "üó∫Ô∏è Tener m√°s experiencias y aventuras","‚ù§Ô∏è Cuidar mi salud y bienestar a largo plazo"
    ],
    flowImped:[
      "Falta de tiempo","Falta de energ√≠a o motivaci√≥n","Miedo al fracaso",
      "Dudas sobre d√≥nde empezar","Falta de apoyo","Procrastinaci√≥n",
      "No tengo h√°bitos a√∫n","S√≠ndrome del impostor","Otra"
    ],
    evolveTrade:[
      "Mis h√°bitos diarios","Mi alimentaci√≥n","Mis rutinas de descanso","Mi tiempo libre",
      "Mis relaciones sociales","Mis creencias/bloqueos","Mis espacios f√≠sicos","Otra"
    ],
    evolveAtt:[
      "Estoy muy motivado y quiero cambios ya","Quiero ir de a poco pero con foco","Me cuesta la constancia pero quiero intentar"
    ]
  };

  function paintChecklist(listId, items, type="checkbox", nameGroup="grp"){
    const host = document.getElementById(listId);
    host.innerHTML = "";
    items.forEach((txt,i)=>{
      const id = `${listId}-${i}`;
      const input = document.createElement("input");
      input.type = type;
      if(type==="radio") input.name = nameGroup;
      input.id = id;
      const label = document.createElement("label");
      label.className = "chip"; label.setAttribute("for", id);
      label.appendChild(input);
      const span = document.createElement("span"); span.textContent = txt; label.appendChild(span);
      host.appendChild(label);
    });
  }

  // Pintar todos
  paintChecklist("lowBodyList", lists.lowBody);
  paintChecklist("lowSoulList", lists.lowSoul);
  paintChecklist("lowMindList", lists.lowMind);
  paintChecklist("fBodyList", lists.fBody);
  paintChecklist("fSoulList", lists.fSoul);
  paintChecklist("fMindList", lists.fMind);
  paintChecklist("chillMotivList", lists.chillMotiv);
  paintChecklist("flowImpedList", lists.flowImped);
  paintChecklist("evolveTradeList", lists.evolveTrade);
  paintChecklist("evolveAttList", lists.evolveAtt, "radio", "evolveAtt");

// ====== Navegaci√≥n base ======
// helpers de paso
const nextStep = ()=>{
  const next = Math.min(routeScreens.length - 1, stepIndex + 1);
  const target = routeScreens[next];
  if (!target) return;
  stepIndex = next;
  show(target);
  if (target === "scr-summary") renderSummary();
};
const prevStep = ()=>{
  const prev = Math.max(0, stepIndex - 1);
  stepIndex = prev;
  show(routeScreens[stepIndex]);
};

// (click de goModes se maneja en el bloque de Email)
$go("backIntro").addEventListener("click", ()=> show("scr-intro"));

// ====== Email Intro ======
const emailInput = document.getElementById("emailInput");
const goModesBtn = document.getElementById("goModes");
const isEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v||"").trim());

if (emailInput && goModesBtn){
  const refresh = ()=> { goModesBtn.disabled = !isEmail(emailInput.value); };
  emailInput.addEventListener("input", refresh);
  refresh();
  goModesBtn.addEventListener("click", ()=>{
    const v = String(emailInput.value||"").trim();
    if(!isEmail(v)){ toast("Pon√© un correo v√°lido ‚úâÔ∏è"); return; }
    answers.email = v;
    show("scr-modes");
  });
}

// Elegir modo
$$("#modeGrid .card").forEach(card=>{
  card.addEventListener("click", ()=>{
    $$("#modeGrid .card").forEach(c=>c.classList.remove("selected"));
    card.classList.add("selected");
    answers.mode = card.dataset.mode;
    $go("confirmMode").disabled = false;
  });
});
$go("confirmMode").addEventListener("click", ()=>{
  routeScreens = routes[answers.mode];
  stepIndex = 0;
  show(routeScreens[stepIndex]);
});

// Volver a modes
["backToModes1","backToModes2","backToModes3","backToModes4"].forEach(id=>{
  if($go(id)) $go(id).addEventListener("click", ()=> show("scr-modes"));
});

// ====== BACKS para FOUNDATIONS (Body ‚Üí Soul ‚Üí Mind) ======
["backFoundPrev1","backFBody","backFSoul"].forEach(id => {
  const btn = $go(id);
  if (!btn) return;
  btn.addEventListener("click", () => {
    // paso atr√°s dentro del route actual
    stepIndex = Math.max(0, stepIndex - 1);
    show(routeScreens[stepIndex]);
  });
});

// Utilidades selecci√≥n
const getCheckedTexts = sel => $$(sel+" input:checked").map(i=>i.parentElement.textContent.trim());
const getRadioText   = sel => { const el = $$(sel+" input[type=radio]").find(i=>i.checked); return el?el.parentElement.textContent.trim():""; };

// Checklist con l√≠mite y confirm
function bindLimitedChecklist(scrId, listId, countId, storeArrRef){
  const max = Number($("#"+scrId).dataset.limit || 5);
  const inputs = $$("#"+listId+" input");
  const count  = $("#"+countId);

  function update(){
    const ch = inputs.filter(i=>i.checked);
    if(ch.length > max){ ch[ch.length-1].checked = false; }
    const now = inputs.filter(i=>i.checked).length;
    count.textContent = now;
    $go(confirmIdFor(scrId)).disabled = (now < 1);
  }
  inputs.forEach(i=> i.addEventListener("change", update));
  update();

  function confirmIdFor(id){
    return ({
      "scr-low-body":"confirmLowBody","scr-low-soul":"confirmLowSoul","scr-low-mind":"confirmLowMind",
      "scr-f-body":"confirmFBody","scr-f-soul":"confirmFSoul","scr-f-mind":"confirmFMind"
    })[id];
  }

  // Confirm de la pantalla (evita doble XP)
  $go(confirmIdFor(scrId)).addEventListener("click", ()=>{
    const sec = document.getElementById(scrId);
    if (sec.dataset.done === "1") {   // ya confirmada
      nextStep();
      return;
    }
    // Guardar selecci√≥n
    storeArrRef.length = 0;
    getCheckedTexts("#"+listId).forEach(t=>storeArrRef.push(t));
    // Sumar XP una vez
    const xpVal = Number($("#"+scrId).dataset.xp || 13);
    const pillar = $("#"+scrId).dataset.pillar;
    addXP(xpVal, pillar);
    toast(`+${xpVal} XP`);
    // Marcar como hecha y avanzar
    sec.dataset.done = "1";
    nextStep();
  });
}

// Binds LOW + FOUNDATIONS
bindLimitedChecklist("scr-low-body","lowBodyList","lowBodyCount",   answers.low.body);
bindLimitedChecklist("scr-low-soul","lowSoulList","lowSoulCount",   answers.low.soul);
bindLimitedChecklist("scr-low-mind","lowMindList","lowMindCount",   answers.low.mind);
bindLimitedChecklist("scr-f-body",  "fBodyList",  "fBodyCount",     answers.foundations.body);
bindLimitedChecklist("scr-f-soul",  "fSoulList",  "fSoulCount",     answers.foundations.soul);
bindLimitedChecklist("scr-f-mind",  "fMindList",  "fMindCount",     answers.foundations.mind);

// LOW note (0 XP)
$go("backLowMind").addEventListener("click", ()=> prevStep());
$go("confirmLowNote").addEventListener("click", ()=>{
  answers.low.note = $go("lowNote").value.trim();
  nextStep();
});

// CHILL
$go("chillOneThing").addEventListener("input", ()=> $go("confirmChillOpen").disabled = ($go("chillOneThing").value.trim().length<1));
$go("confirmChillOpen").addEventListener("click", ()=>{
  answers.chill.oneThing = $go("chillOneThing").value.trim();
  addXP(21,"ALL"); toast("+21 XP");
  nextStep();
});
const chillInputs = $$("#chillMotivList input");
const updateChill = ()=> $go("confirmChillMotiv").disabled = chillInputs.filter(i=>i.checked).length<1;
chillInputs.forEach(i=> i.addEventListener("change", updateChill)); updateChill();
$go("confirmChillMotiv").addEventListener("click", ()=>{
  answers.chill.motiv = getCheckedTexts("#chillMotivList");
  addXP(13,"ALL"); toast("+13 XP");
  nextStep();
});
$go("backChillOpen").addEventListener("click", ()=> prevStep());

// FLOW
$go("flowGoal").addEventListener("input", ()=> $go("confirmFlowGoal").disabled = ($go("flowGoal").value.trim().length<1));
$go("confirmFlowGoal").addEventListener("click", ()=>{
  answers.flow.goal = $go("flowGoal").value.trim();
  addXP(21,"ALL"); toast("+21 XP");
  nextStep();
});
const flowImps = $$("#flowImpedList input");
const updateFlow = ()=> $go("confirmFlowImped").disabled = flowImps.filter(i=>i.checked).length<1;
flowImps.forEach(i=> i.addEventListener("change", updateFlow)); updateFlow();
$go("confirmFlowImped").addEventListener("click", ()=>{
  answers.flow.imped = getCheckedTexts("#flowImpedList");
  addXP(13,"ALL"); toast("+13 XP");
  nextStep();
});
$go("backFlowGoal").addEventListener("click", ()=> prevStep());

// EVOLVE
$go("evolveGoal").addEventListener("input", ()=> $go("confirmEvolveGoal").disabled = ($go("evolveGoal").value.trim().length<1));
$go("confirmEvolveGoal").addEventListener("click", ()=>{
  answers.evolve.goal = $go("evolveGoal").value.trim();
  addXP(21,"ALL"); toast("+21 XP");
  nextStep();
});
const evTrade = $$("#evolveTradeList input");
const updEvTrade = ()=> $go("confirmEvolveTrade").disabled = evTrade.filter(i=>i.checked).length<1;
evTrade.forEach(i=> i.addEventListener("change", updEvTrade)); updEvTrade();
$go("confirmEvolveTrade").addEventListener("click", ()=>{
  answers.evolve.trade = getCheckedTexts("#evolveTradeList");
  addXP(13,"ALL"); toast("+13 XP");
  nextStep();
});
$go("backEvolveGoal").addEventListener("click", ()=> prevStep());

const evAtt = $$("#evolveAttList input");
evAtt.forEach(i=> i.addEventListener("change", ()=> $go("confirmEvolveAtt").disabled = !evAtt.some(x=>x.checked)));
$go("confirmEvolveAtt").addEventListener("click", ()=>{
  answers.evolve.att = getRadioText("#evolveAttList");
  addXP(21,"ALL"); toast("+21 XP");
  nextStep();
});
$go("backEvolveTrade").addEventListener("click", ()=> prevStep());

// Atajos de teclado (opcional)
document.addEventListener("keydown",(e)=>{
  if(e.key==="ArrowLeft")  prevStep();
  if(e.key==="ArrowRight") nextStep();
});

  function renderSummary(){
    const box = $("#summaryBox");
    const fmt = a => (a && a.length)? a.join(", ") : "‚Äî";
    box.innerHTML = `
      <div><strong>Game Mode:</strong> ${answers.mode||"‚Äî"}</div>
      <div><strong>Email:</strong> ${answers.email||"‚Äî"}</div>
      <hr style="border:0;border-top:1px solid var(--ring);margin:8px 0">
      ${
        answers.mode==="LOW"
        ? `
          <div><strong>LOW ¬∑ Body:</strong> ${fmt(answers.low.body)}</div>
          <div><strong>LOW ¬∑ Soul:</strong> ${fmt(answers.low.soul)}</div>
          <div><strong>LOW ¬∑ Mind:</strong> ${fmt(answers.low.mind)}</div>
          ${answers.low.note?`<div><strong>Nota:</strong> ${answers.low.note}</div>`:""}
        `
        : `
          ${answers.mode==="CHILL" ? `<div><strong>CHILL ¬∑ Una cosa:</strong> ${answers.chill.oneThing}</div>
          <div><strong>CHILL ¬∑ Motivaciones:</strong> ${fmt(answers.chill.motiv)}</div>`:""}
          ${answers.mode==="FLOW" ? `<div><strong>FLOW ¬∑ Objetivo:</strong> ${answers.flow.goal}</div>
          <div><strong>FLOW ¬∑ Impedimentos:</strong> ${fmt(answers.flow.imped)}</div>`:""}
          ${answers.mode==="EVOLVE" ? `<div><strong>EVOLVE ¬∑ Objetivo:</strong> ${answers.evolve.goal}</div>
          <div><strong>EVOLVE ¬∑ Ajustes:</strong> ${fmt(answers.evolve.trade)}</div>
          <div><strong>EVOLVE ¬∑ Actitud:</strong> ${answers.evolve.att}</div>`:""}
          <hr style="border:0;border-top:1px solid var(--ring);margin:8px 0">
          <div><strong>Foundations ¬∑ Body:</strong> ${fmt(answers.foundations.body)}</div>
          <div><strong>Foundations ¬∑ Soul:</strong> ${fmt(answers.foundations.soul)}</div>
          <div><strong>Foundations ¬∑ Mind:</strong> ${fmt(answers.foundations.mind)}</div>
        `
      }
      <hr style="border:0;border-top:1px solid var(--ring);margin:8px 0">
      <div><strong>ü´Ä Body:</strong> ${Math.round(xp.Body)} XP</div>
      <div><strong>üß† Mind:</strong> ${Math.round(xp.Mind)} XP</div>
      <div><strong>üèµÔ∏è Soul:</strong> ${Math.round(xp.Soul)} XP</div>
      <div style="margin-top:6px"><strong>Total:</strong> ${Math.round(xp.total)} XP</div>
    `;
  }

  document.addEventListener("keydown",(e)=>{ if(e.key==="ArrowLeft"){stepIndex=Math.max(0,--stepIndex);show(routeScreens[stepIndex]);} if(e.key==="ArrowRight"){stepIndex=Math.min(routeScreens.length-1,++stepIndex);show(routeScreens[stepIndex]);} });
  $go("restart").addEventListener("click", ()=> location.reload());

  // Init
  drawProgress();
  window.JOURNEY_STATE = { get answers(){ return answers; }, get xp(){ return xp; } };
})();
</script>

<!-- Tu JS de env√≠o a Google Forms -->
<script src="js/formsintro.js"></script>
</body>
</html>
